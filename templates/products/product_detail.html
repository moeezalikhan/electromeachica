{% extends 'base.html' %}
{% load static %}
{% block title %}Market - Sectors{% endblock %}
{% block content %}
<!-- Page Title -->
<section class="page-title" style="background-image:url('{% static 'images/background/2.jpg'%}')">
  <div class="auto-container">
    <h1>Product Single</h1>
    <ul class="page-breadcrumb">
      <li><a href="{% url 'home' %}">Home</a></li>
      <li><a href="{% url 'product_list' %}">Products</a></li>
      <li>Product Single</li>
    </ul>
  </div>
</section>
<!-- End Page Title -->

<!-- Sidebar Page Container -->
<div class="sidebar-page-container">
  <div class="auto-container">
    <div class="row clearfix">

      <!-- Content Side -->
      <div class="content-side pull-right col-lg-9 col-md-8 col-sm-12 col-xs-12">
        <div class="shop-single">
          <div class="product-details">

            <!-- Basic Details -->
            <div class="basic-details">
              <div class="row clearfix">
                <div class="image-column col-md-6 col-sm-6 col-xs-12">
                  {% if images %}
                  <div class="owl-carousel owl-theme single-item-carousel">
                    {% for image in images %}
                    <figure class="image-box">
                      <a href="{{ image.image.url }}" data-fancybox="gallery" title="{{ product.title }}">
                        <img src="{{ image.image.url }}" alt="{{ product.title }}" style="width:100%; height:400px; object-fit:cover; border-radius:10px;">
                      </a>
                    </figure>
                    {% endfor %}
                  </div>
                  {% else %}
                  <figure class="image-box">
                    <img src="{% static 'images/no-image.jpg' %}" alt="No Image" style="width:100%; height:400px; object-fit:cover; border-radius:10px;">
                  </figure>
                  {% endif %}
                </div>

                <!-- Info Column -->
                <div class="info-column col-md-6 col-sm-6 col-xs-12">
                  <div class="details-header">
                    <h4>{{ product.title }}</h4>
                    <p><strong>Category:</strong> {{ product.get_category_display }}</p>
                  </div>
                  <div class="text">
                    <p>{{ product.short_description }}</p>
                  </div>
                  <p><strong>Availability:</strong>
                    {% if product.availability %}
                      <span style="color:green;">In Stock</span>
                    {% else %}
                      <span style="color:red;">Out of Stock</span>
                    {% endif %}
                  </p>
                </div>
              </div>
            </div>
            <!-- End Basic Details -->

            <!-- Related Products -->
            <div class="related-products mt-5">
              <h2>Related Products</h2>
              <div class="row clearfix">
                {% for related in related_products %}
                <div class="shop-item col-lg-4 col-md-6 col-sm-6 col-xs-12">
                  <div class="inner-box">
                    <a href="{% url 'product_detail' related.pk %}">
                      <div class="image-box">
                        {% with first_image=related.images.first %}
                          {% if first_image %}
                          <img src="{{ first_image.image.url }}" alt="{{ related.title }}" style="width:100%; height:250px; object-fit:cover; border-radius:8px;">
                          {% else %}
                          <img src="{% static 'images/no-image.jpg' %}" alt="No Image" style="width:100%; height:250px; object-fit:cover; border-radius:8px;">
                          {% endif %}
                        {% endwith %}
                      </div>
                      <div class="lower-content text-center">
                        <h4>{{ related.title|truncatewords:8 }}</h4>
                      </div>
                    </a>
                  </div>
                </div>
                {% empty %}
                <div class="col-12 text-center">
                  <p>No related products found.</p>
                </div>
                {% endfor %}
              </div>
            </div>
            <!-- End Related Products -->

          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="sidebar-side col-lg-3 col-md-4 col-sm-12 col-xs-12">
        <aside class="sidebar shop-sidebar">

          <!-- Search -->
          <div class="sidebar-widget search-box style-two">
            <form method="get" action="">
              <div class="form-group">
                <input type="search" name="q" placeholder="Search..." value="{{ search_query }}">
                {% if category %}
                <input type="hidden" name="category" value="{{ category }}">
                {% endif %}
                <button type="submit"><span class="icon fa fa-search"></span></button>
              </div>
            </form>
          </div>

          <!-- Categories -->
          <div class="sidebar-widget sidebar-blog-category">
            <div class="sidebar-title"><h2>Categories</h2></div>
            <ul class="blog-cat">
              <li {% if not category %}class="active"{% endif %}>
                <a href="?">View All</a>
              </li>
              {% for key, label in categories %}
              <li {% if category == key %}class="active"{% endif %}>
                <a href="?category={{ key }}{% if search_query %}&q={{ search_query }}{% endif %}">
                  {{ label }}
                </a>
              </li>
              {% endfor %}
            </ul>
          </div>

        </aside>
      </div>

    </div>
  </div>
</div>
{% endblock %}
