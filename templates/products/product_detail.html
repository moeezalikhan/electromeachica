{% extends 'base.html' %}
{% load static %}
{% block title %}Machenary - Product Details{% endblock %}
{% block content %}

<style>
.whatsapp-cta {
    display: flex;
    align-items: center;
    background: #25D366;
    color: #fff;
    padding: 56px -1px;
    height: 65px;
    border-radius: 127px;
    text-decoration: none;
    gap: 14px;
    width: 116%;
    max-width: 345px;
    box-shadow: 0 6px 18px rgba(37, 211, 102, 0.35);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.fa-brands, .fab {
    font-weight: 600;
    padding-left: 1px;
}
.whatsapp-cta:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(37, 211, 102, 0.45);
    color: #fff;
}

.whatsapp-cta .icon {
    width: 66px;
    height: 55px;
    border-radius: 50%;
    padding-left: 4px;
    background: rgba(311, 349, 318, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
}

.whatsapp-cta .text {
    display: flex;
    flex-direction: column;
    line-height: 1.2;
}

.whatsapp-cta .text .small-text {
    font-size: 13px;
    padding-top: 23px;
    font-weight: 600;
    opacity: 0.9;
}

.whatsapp-cta .text .status {
    background: rgba(255,255,255,0.35);
    padding: 1px 8px;
    margin-left: 6px;
    border-radius: 8px;
    font-size: 11px;
}

.whatsapp-cta .text .main-text {
    font-size: 18px;
    font-weight: 600;
    margin-top: -2px;
}

  .product-detail-hero {
    background-image: url("{% static 'images/background/2.jpg' %}");
    background-size: cover;
    background-position: center;
  }
</style>


<!-- Page Title -->
<section class="page-title product-detail-hero">
  <div class="auto-container">
    <h1>{{ product.title }}</h1>
    <ul class="page-breadcrumb">
      <li><a href="{% url 'home' %}">Home</a></li>
      <li><a href="{% url 'products' %}">Products</a></li>
      <li>{{ product.title }}</li>
    </ul>
  </div>
</section>


<!-- Sidebar Page Container -->
<div class="sidebar-page-container">
  <div class="auto-container">
    <div class="row clearfix">

      <!-- Content Side -->
      <div class="content-side pull-right col-lg-9 col-md-8 col-sm-12 col-xs-12">
        <div class="shop-single">
          <div class="product-details">

            <!-- Product Images -->
            <div class="basic-details">
              <div class="row clearfix">
                <div class="image-column col-md-6 col-sm-6 col-xs-12">
                  {% if images %}
                  <div class="owl-carousel owl-theme single-item-carousel">
                    {% for image in images %}
                    <figure class="image-box">
                      <a href="{{ image.image.url }}" data-fancybox="gallery" title="{{ product.title }}">
                        <img src="{{ image.image.url }}" alt="{{ product.title }}" style="width:100%; height:400px; object-fit:cover; border-radius:10px;">
                      </a>
                    </figure>
                    {% endfor %}
                  </div>
                  {% else %}
                  <figure class="image-box">
                    <img src="{% static 'images/no-image.jpg' %}" alt="No Image" style="width:100%; height:400px; object-fit:cover; border-radius:10px;">
                  </figure>
                  {% endif %}
                </div>

                <!-- Product Info -->
                <div class="info-column col-md-6 col-sm-6 col-xs-12">
                  <div class="details-header">
                    <h4>{{ product.title }}</h4>
                    <p><strong>Category:</strong> {{ product.category.name }}</p>
                  </div>

                  <div class="text">
                    <p>{{ product.short_description }}</p>
                  </div>

                  <p><strong>Availability:</strong>
                    {% if product.availability %}
                      <span style="color:green;">In Stock</span>
                    {% else %}
                      <span style="color:red;">Out of Stock</span>
                    {% endif %}
                  </p>

                  {% if whatsapp_number %}
<a href="https://wa.me/{{ whatsapp_number|urlencode }}?text={{ whatsapp_message|urlencode }}"
   class="whatsapp-cta"
   target="_blank"
   rel="noopener noreferrer">

    <div class="icon">
        <i class="fab fa-whatsapp"></i>
    </div>

    <div class="text">
        <span class="small-text">
            Ask Me Anything
            <span class="status">Online</span>
        </span>
        <span class="main-text">Click to Chat via WhatsApp</span>
    </div>

</a>
{% endif %}

                </div>
              </div>
            </div>


            <!-- Related / Category Products -->
            <div class="related-products mt-5">
              <h2>{% if category %}Products in {{ category|title }}{% else %}Related Products{% endif %}</h2>
              <div class="row clearfix">
                {% for related in related_products %}
                <div class="shop-item col-lg-4 col-md-6 col-sm-6 col-xs-12">
                  <div class="inner-box">
                    <a href="{% url 'product_detail' related.pk %}">
                      <div class="image-box">
                        {% with first_image=related.images.all|first %}
                          {% if first_image %}
                          <img src="{{ first_image.image.url }}" alt="{{ related.title }}" style="width:100%; height:250px; object-fit:cover; border-radius:8px;">
                          {% else %}
                          <img src="{% static 'images/no-image.jpg' %}" alt="No Image" style="width:100%; height:250px; object-fit:cover; border-radius:8px;">
                          {% endif %}
                        {% endwith %}
                      </div>
                      <div class="lower-content text-center">
                        <h4>{{ related.title|truncatewords:8 }}</h4>
                      </div>
                    </a>
                  </div>
                </div>
                {% empty %}
                <div class="col-12 text-center">
                  <p>No products found.</p>
                </div>
                {% endfor %}
              </div>
            </div>

          </div>
        </div>
      </div>


      <!-- Sidebar -->
      <div class="sidebar-side col-lg-3 col-md-4 col-sm-12 col-xs-12">
        <aside class="sidebar shop-sidebar">

          <!-- Search -->
          <div class="sidebar-widget search-box style-two">
            <form method="get" action="">
              <div class="form-group">
                <input type="search" name="q" placeholder="Search..." value="{{ search_query }}">
                {% if category %}
                <input type="hidden" name="category" value="{{ category }}">
                {% endif %}
                <button type="submit"><span class="icon fa fa-search"></span></button>
              </div>
            </form>
          </div>

          <!-- Categories -->
          <div class="sidebar-widget sidebar-blog-category">
            <div class="sidebar-title"><h2>Categories</h2></div>
            <ul class="blog-cat">
              <li class="{% if not category %}active{% endif %}">
                <a href="{% url 'products' %}">View All</a>
              </li>

              {% for cat in categories %}
              <li class="{% if cat.id|stringformat:'s' == category %}active{% endif %}">
                <a href="{% url 'products' %}?category={{ cat.id }}{% if search_query %}&q={{ search_query }}{% endif %}">
                  {{ cat.name }}
                </a>
              </li>
              {% endfor %}
            </ul>
          </div>

        </aside>
      </div>

    </div>
  </div>
</div>

{% endblock %}
